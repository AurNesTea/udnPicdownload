# 退休力資料處理程式使用說明

## 概述
本程式用於將 `retire 2025.csv` 檔案轉換為與 `退休力-第三階段(final).xlsx - 送統計.csv` 相同的格式，以便進行後續的資料分析。

## 檔案說明

### 輸入檔案
- **原始檔案**: `data/retire 2025.csv` (2,449 筆資料，33 個欄位)
- **參考檔案**: `data/退休力-第三階段(final).xlsx - 送統計.csv` (4,763 筆資料，110 個欄位)

### 輸出檔案
- **處理後檔案**: `data/retire_2025_processed.csv` (2,449 筆資料，110 個欄位)

## 程式檔案

1. **`data_process.py`** - 基礎版本
   - 基本的資料轉換功能
   - 問卷欄位初始化為 0

2. **`data_process_complete.py`** - 完整版本
   - 包含問卷轉換邏輯
   - 效能優化
   - 詳細的資料分析

## 欄位對應關係

### 基本欄位
| 原始檔案欄位 | 目標檔案欄位 | 說明 |
|-------------|-------------|------|
| vip_id | vip_id | 會員ID |
| age | age | 年齡 |
| sex | sex | 性別 |
| grade | grade | 等級 |
| city | city | 城市 |
| cluster（動物種類） | cluster | 群組 |

### 分數欄位
| 原始檔案欄位 | 目標檔案欄位 | 說明 |
|-------------|-------------|------|
| 總分 | 總分 | 總分數 |
| 財務 | 財務分數 | 財務分數 |
| 健康 | 健康分數 | 健康分數 |
| 社交 | 社交分數 | 社交分數 |
| 心靈 | 心靈分數 | 心靈分數 |
| 獨立 | 獨立分數 | 獨立分數 |

### 問卷欄位
原始檔案的 Q1-Q20 欄位轉換為目標檔案的 A1.1-E20.6 格式：

- **A組題目**: A1.1-A7.6 (共 28 個欄位)
- **B組題目**: B8.1-B15.3 (共 40 個欄位)
- **C組題目**: C16.1-C17.5 (共 9 個欄位)
- **D組題目**: D18.1-D18.6 (共 6 個欄位)
- **E組題目**: E19.1-E20.6 (共 12 個欄位)

## 使用方法

### 1. 環境準備
```bash
# 安裝必要的套件
pip3 install pandas numpy chardet
```

### 2. 執行程式
```bash
# 執行完整版程式
python3 data_process_complete.py

# 或執行基礎版程式
python3 data_process.py
```

### 3. 檢查結果
程式執行完成後，會生成 `data/retire_2025_processed.csv` 檔案，包含：
- 2,449 筆資料
- 110 個欄位（與參考檔案格式一致）
- UTF-8 編碼

## 問卷轉換邏輯

### 轉換函數
`convert_question_data(q_value)` 函數負責將原始問卷答案轉換為目標格式：

```python
def convert_question_data(q_value):
    """
    將原始問卷資料轉換為目標格式
    """
    if pd.isna(q_value):
        return 0
    
    # 處理字串格式的答案
    if isinstance(q_value, str):
        if ',' in q_value:
            q_value = q_value.split(',')[0]  # 取第一個選項
        try:
            q_value = float(q_value)
        except ValueError:
            return 0
    
    # 轉換邏輯（可根據實際需求調整）
    if q_value in [1, 3, 5]:
        return 1
    elif q_value in [2, 4, 6]:
        return 0
    else:
        return 0
```

### 自訂轉換邏輯
如需調整問卷轉換邏輯，請修改 `convert_question_data` 函數中的轉換規則。

## 程式特色

1. **自動編碼偵測**: 使用 `chardet` 自動偵測檔案編碼
2. **資料結構分析**: 詳細分析兩份檔案的欄位差異
3. **效能優化**: 使用 `pd.concat` 避免 DataFrame 碎片化警告
4. **錯誤處理**: 完整的異常處理機制
5. **詳細輸出**: 提供處理過程和結果的詳細資訊

## 注意事項

1. **問卷轉換**: 目前實作的問卷轉換邏輯是範例，實際應用時需要根據具體的問卷設計來調整
2. **資料完整性**: 程式會保留所有原始資料，不會遺失任何資訊
3. **編碼支援**: 支援多種編碼格式（UTF-8, Big5 等）
4. **檔案路徑**: 確保 `data/` 目錄存在且包含必要的輸入檔案

## 技術細節

- **Python 版本**: 3.6+
- **主要套件**: pandas, numpy, chardet
- **處理方式**: 批次處理，一次性轉換所有資料
- **記憶體使用**: 適合處理中等規模的資料集（數千筆資料）

## 疑難排解

### 常見問題

1. **編碼錯誤**: 如果遇到編碼問題，程式會自動偵測並使用正確的編碼
2. **檔案不存在**: 確保輸入檔案路徑正確
3. **記憶體不足**: 對於大型資料集，可能需要增加系統記憶體

### 聯絡資訊
如有問題或需要客製化調整，請聯繫開發團隊。
